---
description: æµ‹è¯•è°ƒè¯•ç­–ç•¥è§„åˆ™
globs: 
alwaysApply: false
---
# æµ‹è¯•è°ƒè¯•ç­–ç•¥è§„åˆ™

> åŸºäºå®é™…é¡¹ç›®ç»éªŒæ€»ç»“çš„æµ‹è¯•è°ƒè¯•æœ€ä½³å®è·µ

## ğŸš¨ æ ¸å¿ƒè°ƒè¯•æ³•åˆ™

### ğŸ“Š 3æ¬¡å°è¯•åˆ‡æ¢ç­–ç•¥æ³•åˆ™
**é€‚ç”¨åœºæ™¯**ï¼šå½“ç°æœ‰æµ‹è¯•æŒç»­å¤±è´¥æ—¶

```
å°è¯•æ¬¡æ•° 1-3ï¼šä¿®å¤ç°æœ‰æµ‹è¯•
â”œâ”€â”€ æ£€æŸ¥è¯­æ³•é”™è¯¯
â”œâ”€â”€ éªŒè¯mocké…ç½®
â””â”€â”€ è°ƒæ•´æ–­è¨€é€»è¾‘

å°è¯•æ¬¡æ•° 4+ï¼šåˆ‡æ¢ç­–ç•¥
â”œâ”€â”€ åˆ›å»ºæœ€ç®€å•çš„éªŒè¯æµ‹è¯•
â”œâ”€â”€ ç¡®è®¤åŸºç¡€åŠŸèƒ½æ­£å¸¸
â””â”€â”€ å†å¤„ç†å¤æ‚åœºæ™¯
```

### ğŸ”„ æ¸è¿›å¼æµ‹è¯•ç­–ç•¥
```typescript
// Level 1: æœ€åŸºç¡€éªŒè¯
it('å®ä¾‹åˆ›å»ºéªŒè¯', () => {
  const instance = createInstance()
  expect(instance).toBeDefined()
})

// Level 2: æ¥å£éªŒè¯
it('æ¥å£å­˜åœ¨æ€§éªŒè¯', () => {
  const instance = createInstance()
  expect(typeof instance.method).toBe('function')
  expect(typeof instance.property).toBe('string')
})

// Level 3: åŠŸèƒ½éªŒè¯
it('åŸºç¡€åŠŸèƒ½éªŒè¯', async () => {
  const instance = createInstance()
  const result = await instance.method()
  expect(result).toBeDefined()
})

// Level 4: å¤æ‚åœºæ™¯
it('å¤æ‚äº¤äº’éªŒè¯', async () => {
  // åªåœ¨å‰é¢çº§åˆ«å…¨éƒ¨é€šè¿‡åè¿›è¡Œ
})
```

## ğŸ” é—®é¢˜è¯Šæ–­æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šå¿«é€Ÿæ’é™¤æ³•
```typescript
// 1. è¯­æ³•æ£€æŸ¥
npm run type-check

// 2. åŸºç¡€åŠŸèƒ½æµ‹è¯•
it('smoke test', () => {
  expect(true).toBe(true) // ç¡®ä¿æµ‹è¯•ç¯å¢ƒæ­£å¸¸
})

// 3. å®ä¾‹åˆ›å»ºæµ‹è¯•
it('instance creation', () => {
  const instance = createTarget()
  expect(instance).toBeDefined()
})
```

### ç¬¬äºŒæ­¥ï¼šæ¥å£éªŒè¯æ³•
```typescript
// éªŒè¯æ‰€æœ‰é¢„æœŸçš„å±æ€§å’Œæ–¹æ³•éƒ½å­˜åœ¨
it('interface validation', () => {
  const instance = createTarget()
  
  // éªŒè¯æ–¹æ³•
  expect(typeof instance.expectedMethod).toBe('function')
  
  // éªŒè¯å±æ€§ç±»å‹
  expect(typeof instance.expectedProperty).toBe('expectedType')
  
  // éªŒè¯å“åº”å¼å±æ€§
  expect(instance.reactiveProperty.value).toBeDefined()
})
```

### ç¬¬ä¸‰æ­¥ï¼šåˆ†å±‚éš”ç¦»æ³•
```typescript
// éš”ç¦»ç¬¬ä¸‰æ–¹ä¾èµ–
describe('without external dependencies', () => {
  it('core logic works', () => {
    // æµ‹è¯•ä¸ä¾èµ–å¤–éƒ¨åº“çš„æ ¸å¿ƒé€»è¾‘
  })
})

// éš”ç¦»å¤æ‚é…ç½®
describe('with minimal config', () => {
  it('basic functionality', () => {
    const instance = createTarget({ minimal: true })
    // ä½¿ç”¨æœ€ç®€é…ç½®æµ‹è¯•
  })
})
```

## ğŸ› ï¸ Mockç­–ç•¥å†³ç­–æ ‘

```
éœ€è¦æµ‹è¯•ç¬¬ä¸‰æ–¹åº“äº¤äº’å—ï¼Ÿ
â”œâ”€â”€ æ˜¯ â†’ ç¬¬ä¸‰æ–¹åº“å¤æ‚å—ï¼Ÿ
â”‚   â”œâ”€â”€ æ˜¯ â†’ ä½¿ç”¨é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ å¦ â†’ ç®€å•mock
â””â”€â”€ å¦ â†’ ä¸éœ€è¦mock
```

### ç®€å•Mockæ¨¡å¼
```typescript
// é€‚ç”¨äºï¼šç®€å•çš„å·¥å…·å‡½æ•°
vi.mock('simple-library', () => ({
  simpleFunction: vi.fn(() => 'mocked result')
}))
```

### é›†æˆæµ‹è¯•æ¨¡å¼
```typescript
// é€‚ç”¨äºï¼šå¤æ‚çš„çŠ¶æ€ç®¡ç†åº“ã€UIåº“ç­‰
describe('integration test', () => {
  it('works with real dependencies', () => {
    // ä½¿ç”¨çœŸå®çš„ä¾èµ–åº“è¿›è¡Œæµ‹è¯•
    // éªŒè¯æ¥å£å¥‘çº¦è€Œéå†…éƒ¨å®ç°
  })
})
```

## âš¡ å¼‚æ­¥æµ‹è¯•è°ƒè¯•è§„åˆ™

### âœ… æ¨èæ¨¡å¼
```typescript
// ç›´æ¥awaitæ¨¡å¼
it('async operation', async () => {
  const result = await asyncOperation()
  expect(result).toBe(expected)
})

// Promiseæ¨¡å¼
it('promise operation', () => {
  return asyncOperation().then(result => {
    expect(result).toBe(expected)
  })
})
```

### âŒ é¿å…æ¨¡å¼
```typescript
// é¿å…ï¼šå¤æ‚çš„å›è°ƒæµ‹è¯•
it('avoid this pattern', (done) => {
  let result
  asyncOperation().then(res => {
    result = res
    // å¤æ‚çš„çŠ¶æ€ä¾èµ–
  })
  setTimeout(() => {
    expect(result).toBe(expected) // resultå¯èƒ½æœªå®šä¹‰
    done()
  }, 100)
})
```

## ğŸ”§ è°ƒè¯•å·¥å…·é›†

### 1. çŠ¶æ€å¿«ç…§
```typescript
// è°ƒè¯•æ—¶è¾“å‡ºå½“å‰çŠ¶æ€
it('debug state', () => {
  const instance = createInstance()
  console.log('Current state:', JSON.stringify(instance.state, null, 2))
  
  // è¿›è¡Œæ“ä½œ
  instance.operation()
  
  console.log('After operation:', JSON.stringify(instance.state, null, 2))
})
```

### 2. ç±»å‹æ£€æŸ¥å™¨
```typescript
// è¿è¡Œæ—¶ç±»å‹éªŒè¯è¾…åŠ©å‡½æ•°
const validateTypes = (obj: any, schema: Record<string, string>) => {
  Object.entries(schema).forEach(([key, expectedType]) => {
    const actualType = typeof obj[key]
    if (actualType !== expectedType) {
      throw new Error(`Type mismatch: ${key} expected ${expectedType}, got ${actualType}`)
    }
  })
}

it('type validation', () => {
  const instance = createInstance()
  validateTypes(instance, {
    method: 'function',
    property: 'string',
    config: 'object'
  })
})
```

### 3. æ¥å£å¥‘çº¦éªŒè¯å™¨
```typescript
// é€šç”¨æ¥å£éªŒè¯å™¨
const validateInterface = (instance: any, expectedInterface: any) => {
  Object.keys(expectedInterface).forEach(key => {
    expect(instance).toHaveProperty(key)
    expect(typeof instance[key]).toBe(typeof expectedInterface[key])
  })
}
```

## ğŸ¯ ç‰¹å®šåœºæ™¯è°ƒè¯•ç­–ç•¥

### Vue 3 Composableè°ƒè¯•
```typescript
// å“åº”å¼å±æ€§è°ƒè¯•
it('reactivity debug', () => {
  const { reactive, computed } = createComposable()
  
  // æ£€æŸ¥å“åº”å¼ç±»å‹
  expect(reactive.value).toBeDefined() // ref æˆ– reactive
  expect(computed.value).toBeDefined() // computed
  
  // æ£€æŸ¥å“åº”å¼æ›´æ–°
  const oldValue = computed.value
  reactive.value = newValue
  expect(computed.value).not.toBe(oldValue)
})
```

### TypeScriptç±»å‹é—®é¢˜è°ƒè¯•
```typescript
// ç±»å‹æ–­è¨€è°ƒè¯•
it('type assertion debug', () => {
  const instance = createInstance()
  
  // æ£€æŸ¥å®é™…ç±»å‹
  console.log('Actual type:', typeof instance.property)
  console.log('Is array:', Array.isArray(instance.list))
  console.log('Constructor:', instance.constructor.name)
  
  // è¿›è¡Œç±»å‹éªŒè¯
  expect(instance.property).toSatisfy((value) => 
    typeof value === 'string' || typeof value === 'number'
  )
})
```

## ğŸ“‹ è°ƒè¯•æ£€æŸ¥æ¸…å•

### åŸºç¡€æ£€æŸ¥
- [ ] æµ‹è¯•ç¯å¢ƒæ˜¯å¦æ­£å¸¸è¿è¡Œ
- [ ] å®ä¾‹æ˜¯å¦èƒ½æ­£å¸¸åˆ›å»º
- [ ] æœŸæœ›çš„å±æ€§å’Œæ–¹æ³•æ˜¯å¦å­˜åœ¨
- [ ] ç±»å‹å£°æ˜æ˜¯å¦ä¸å®é™…ä¸€è‡´

### æ·±åº¦æ£€æŸ¥  
- [ ] Mocké…ç½®æ˜¯å¦æ­£ç¡®
- [ ] å¼‚æ­¥æ“ä½œæ˜¯å¦æ­£ç¡®ç­‰å¾…
- [ ] å“åº”å¼å±æ€§æ˜¯å¦æ­£ç¡®è®¿é—®
- [ ] é”™è¯¯è¾¹ç•Œæ˜¯å¦æœ‰é€‚å½“å¤„ç†

### æ€§èƒ½æ£€æŸ¥
- [ ] æµ‹è¯•æ‰§è¡Œæ—¶é—´æ˜¯å¦åˆç†
- [ ] å†…å­˜æ³„æ¼æ˜¯å¦å­˜åœ¨
- [ ] é‡å¤åˆ›å»ºå®ä¾‹æ˜¯å¦æœ‰é—®é¢˜

## ğŸš€ è°ƒè¯•æ•ˆç‡ä¼˜åŒ–

### 1. å¿«é€Ÿåé¦ˆå¾ªç¯
```bash
# è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
npm test -- path/to/test.spec.ts

# è¿è¡Œç‰¹å®šæµ‹è¯•
npm test -- --grep "specific test name"

# ç›‘è§†æ¨¡å¼
npm test -- --watch
```

### 2. å¹¶è¡Œè°ƒè¯•
```typescript
// å¤šä¸ªç®€å•æµ‹è¯•å¹¶è¡ŒéªŒè¯
describe.concurrent('parallel debugging', () => {
  it.concurrent('test 1', async () => { /* ... */ })
  it.concurrent('test 2', async () => { /* ... */ })
  it.concurrent('test 3', async () => { /* ... */ })
})
```

### 3. æ¡ä»¶è°ƒè¯•
```typescript
// åŸºäºç¯å¢ƒçš„è°ƒè¯•ä¿¡æ¯
const DEBUG = process.env.NODE_ENV === 'test'

it('conditional debug', () => {
  const result = performOperation()
  
  if (DEBUG) {
    console.log('Debug info:', result)
  }
  
  expect(result).toBe(expected)
})
```

è¿™äº›è§„åˆ™å°†å¸®åŠ©åœ¨é‡åˆ°æµ‹è¯•é—®é¢˜æ—¶å¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜ï¼Œé¿å…åœ¨é”™è¯¯çš„æ–¹å‘ä¸Šæµªè´¹æ—¶é—´ã€‚ 