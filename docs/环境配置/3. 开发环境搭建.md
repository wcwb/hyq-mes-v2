# MESåç«¯å¼€å‘ç¯å¢ƒæ­å»ºæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›äº†è¯¦ç»†çš„MESåç«¯ç³»ç»Ÿå¼€å‘ç¯å¢ƒæ­å»ºæ­¥éª¤ï¼Œé€‚ç”¨äºUbuntuã€macOSå’ŒWindowsï¼ˆWSL2ï¼‰ç¯å¢ƒã€‚

## ğŸ¯ æ­å»ºç›®æ ‡

å®Œæˆæœ¬æŒ‡å—åï¼Œæ‚¨å°†æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„å¼€å‘ç¯å¢ƒï¼ŒåŒ…æ‹¬ï¼š
- âœ… PHP 8.1+ å¼€å‘ç¯å¢ƒ
- âœ… MySQL 8.0+ æ•°æ®åº“
- âœ… Redis ç¼“å­˜æœåŠ¡
- âœ… Nginx WebæœåŠ¡å™¨
- âœ… Composer åŒ…ç®¡ç†å™¨
- âœ… Node.js å‰ç«¯å·¥å…·é“¾
- âœ… MESé¡¹ç›®é…ç½®

## ğŸ§ Ubuntu/Debian ç¯å¢ƒæ­å»º

### 1. ç³»ç»Ÿæ›´æ–°

```bash
# æ›´æ–°ç³»ç»ŸåŒ…åˆ—è¡¨
sudo apt update && sudo apt upgrade -y

# å®‰è£…åŸºç¡€å·¥å…·
sudo apt install -y curl wget git unzip software-properties-common apt-transport-https ca-certificates gnupg lsb-release
```

### 2. å®‰è£…PHP 8.1+

```bash
# æ·»åŠ PHPå®˜æ–¹PPAæº
sudo add-apt-repository ppa:ondrej/php -y
sudo apt update

# å®‰è£…PHPåŠå¿…éœ€æ‰©å±•
sudo apt install -y php8.1 php8.1-fpm php8.1-cli php8.1-common \
    php8.1-pgsql php8.1-redis php8.1-curl php8.1-gd php8.1-mbstring \
    php8.1-xml php8.1-zip php8.1-bcmath php8.1-json php8.1-tokenizer \
    php8.1-ctype php8.1-fileinfo php8.1-dom php8.1-iconv php8.1-intl \
    php8.1-openssl

# éªŒè¯PHPå®‰è£…
php -v
php -m | grep -E "(pgsql|redis|curl|gd|mbstring)"
```

### 3. å®‰è£…Composer

```bash
# ä¸‹è½½å¹¶å®‰è£…Composer
curl -sS https://getcomposer.org/installer | php
sudo mv composer.phar /usr/local/bin/composer
sudo chmod +x /usr/local/bin/composer

# éªŒè¯å®‰è£…
composer --version

# é…ç½®å›½å†…é•œåƒï¼ˆå¯é€‰ï¼Œæå‡ä¸‹è½½é€Ÿåº¦ï¼‰
composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/
```

### 4. å®‰è£…PostgreSQL 14+

```bash
# å®‰è£…PostgreSQLæœåŠ¡å™¨
sudo apt install -y postgresql postgresql-client postgresql-contrib

# å¯åŠ¨PostgreSQLæœåŠ¡
sudo systemctl start postgresql
sudo systemctl enable postgresql

# åˆ‡æ¢åˆ°postgresç”¨æˆ·å¹¶é…ç½®
sudo -u postgres psql << EOF
-- è®¾ç½®postgresç”¨æˆ·å¯†ç 
ALTER USER postgres PASSWORD 'postgres_password';

-- åˆ›å»ºå¼€å‘æ•°æ®åº“
CREATE DATABASE mes_development WITH ENCODING 'UTF8' LC_COLLATE='zh_CN.UTF-8' LC_CTYPE='zh_CN.UTF-8';

-- åˆ›å»ºå¼€å‘ç”¨æˆ·
CREATE USER mes_dev WITH PASSWORD 'mes_dev_password';

-- æˆæƒç»™å¼€å‘ç”¨æˆ·
GRANT ALL PRIVILEGES ON DATABASE mes_development TO mes_dev;
GRANT ALL PRIVILEGES ON SCHEMA public TO mes_dev;

-- é€€å‡º
\q
EOF

# é…ç½®PostgreSQLå…è®¸æœ¬åœ°è¿æ¥
sudo sed -i "s/#listen_addresses = 'localhost'/listen_addresses = 'localhost'/" /etc/postgresql/*/main/postgresql.conf

# é…ç½®å®¢æˆ·ç«¯è®¤è¯
sudo bash -c 'cat >> /etc/postgresql/*/main/pg_hba.conf << EOF

# å¼€å‘ç¯å¢ƒæœ¬åœ°è¿æ¥é…ç½®
local   all             mes_dev                                 md5
host    all             mes_dev         127.0.0.1/32            md5
EOF'

# é‡å¯PostgreSQLæœåŠ¡
sudo systemctl restart postgresql

# éªŒè¯æ•°æ®åº“è¿æ¥
psql -U mes_dev -d mes_development -h localhost -c "SELECT version();"
```

### 5. å®‰è£…Redis

```bash
# å®‰è£…RedisæœåŠ¡å™¨
sudo apt install -y redis-server

# å¯åŠ¨RedisæœåŠ¡
sudo systemctl start redis-server
sudo systemctl enable redis-server

# é…ç½®Redisï¼ˆå¯é€‰å¯†ç ï¼‰
sudo sed -i 's/# requirepass foobared/requirepass mes_redis_password/' /etc/redis/redis.conf
sudo systemctl restart redis-server

# éªŒè¯Redisè¿æ¥
redis-cli ping
# å¦‚æœè®¾ç½®äº†å¯†ç ï¼Œä½¿ç”¨ï¼š
redis-cli -a mes_redis_password ping
```

### 6. å®‰è£…Nginx

```bash
# å®‰è£…Nginx
sudo apt install -y nginx

# å¯åŠ¨NginxæœåŠ¡
sudo systemctl start nginx
sudo systemctl enable nginx

# åˆ›å»ºMESé¡¹ç›®é…ç½®æ–‡ä»¶
sudo tee /etc/nginx/sites-available/mes-backend << 'EOF'
server {
    listen 80;
    server_name mes-backend.local;
    root /var/www/mes-backend/public;
    index index.php index.html;

    # å¤„ç†Laravelè·¯ç”±
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    # å¤„ç†PHPæ–‡ä»¶
    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
        fastcgi_hide_header X-Powered-By;
    }

    # éšè—æ•æ„Ÿæ–‡ä»¶
    location ~ /\.(ht|env) {
        deny all;
    }

    # é™æ€æ–‡ä»¶ç¼“å­˜
    location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
EOF

# å¯ç”¨ç«™ç‚¹é…ç½®
sudo ln -s /etc/nginx/sites-available/mes-backend /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### 7. å®‰è£…Node.js

```bash
# æ·»åŠ NodeSourceå®˜æ–¹æº
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -

# å®‰è£…Node.js
sudo apt install -y nodejs

# éªŒè¯å®‰è£…
node --version
npm --version

# å®‰è£…å¸¸ç”¨å…¨å±€å·¥å…·
sudo npm install -g npm@latest yarn
```

## ğŸ macOS ç¯å¢ƒæ­å»º

### 1. å®‰è£…Homebrew

```bash
# å®‰è£…HomebrewåŒ…ç®¡ç†å™¨
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# æ·»åŠ åˆ°PATHï¼ˆæ ¹æ®æç¤ºæ“ä½œï¼‰
echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> ~/.zprofile
eval "$(/opt/homebrew/bin/brew shellenv)"
```

### 2. å®‰è£…PHP

```bash
# å®‰è£…PHPåŠæ‰©å±•
brew install php@8.1
brew install php@8.1-redis

# é“¾æ¥PHPåˆ°ç³»ç»ŸPATH
brew link --force --overwrite php@8.1

# éªŒè¯PHPå®‰è£…
php -v
php -m | grep -E "(pgsql|redis|curl|gd|mbstring)"
```

### 3. å®‰è£…å…¶ä»–æœåŠ¡

```bash
# å®‰è£…PostgreSQL
brew install postgresql@15
brew services start postgresql@15

# å®‰è£…Redis
brew install redis
brew services start redis

# å®‰è£…Nginx
brew install nginx
brew services start nginx

# å®‰è£…Composer
brew install composer

# å®‰è£…Node.js
brew install node
```

### 4. é…ç½®æ•°æ®åº“

```bash
# åˆ›å»ºå¼€å‘æ•°æ®åº“å’Œç”¨æˆ·
createdb mes_development
psql mes_development << EOF
-- åˆ›å»ºå¼€å‘ç”¨æˆ·
CREATE USER mes_dev WITH PASSWORD 'mes_dev_password';

-- æˆæƒç»™å¼€å‘ç”¨æˆ·
GRANT ALL PRIVILEGES ON DATABASE mes_development TO mes_dev;
GRANT ALL PRIVILEGES ON SCHEMA public TO mes_dev;

-- é€€å‡º
\q
EOF
```

## ğŸªŸ Windows (WSL2) ç¯å¢ƒæ­å»º

### 1. å¯ç”¨WSL2

```powershell
# åœ¨PowerShellï¼ˆç®¡ç†å‘˜ï¼‰ä¸­è¿è¡Œ
# å¯ç”¨WSLåŠŸèƒ½
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart

# å¯ç”¨è™šæ‹Ÿæœºå¹³å°
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart

# é‡å¯è®¡ç®—æœºåï¼Œè®¾ç½®WSL2ä¸ºé»˜è®¤ç‰ˆæœ¬
wsl --set-default-version 2

# å®‰è£…Ubuntu 22.04
wsl --install -d Ubuntu-22.04
```

### 2. WSL2ä¸­é…ç½®å¼€å‘ç¯å¢ƒ

```bash
# è¿›å…¥WSL2åï¼ŒæŒ‰ç…§Ubuntuç¯å¢ƒæ­å»ºæ­¥éª¤æ“ä½œ
# å‚è€ƒä¸Šé¢çš„Ubuntu/Debianç¯å¢ƒæ­å»ºéƒ¨åˆ†
```

## ğŸ“ é¡¹ç›®ä»£ç è·å–ä¸é…ç½®

### 1. å…‹éš†é¡¹ç›®ä»£ç 

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /var/www
sudo chown -R $USER:$USER /var/www

# å…‹éš†é¡¹ç›®ï¼ˆæ›¿æ¢ä¸ºå®é™…çš„Gitä»“åº“åœ°å€ï¼‰
cd /var/www
git clone https://github.com/your-org/mes-backend.git
cd mes-backend

# è®¾ç½®æ–‡ä»¶æƒé™
sudo chown -R www-data:www-data /var/www/mes-backend
sudo chmod -R 755 /var/www/mes-backend
sudo chmod -R 775 /var/www/mes-backend/storage
sudo chmod -R 775 /var/www/mes-backend/bootstrap/cache
```

### 2. å®‰è£…é¡¹ç›®ä¾èµ–

```bash
# å®‰è£…PHPä¾èµ–
composer install

# å®‰è£…Node.jsä¾èµ–
npm install

# ç¼–è¯‘å‰ç«¯èµ„æº
npm run build
```

### 3. ç¯å¢ƒé…ç½®

```bash
# å¤åˆ¶ç¯å¢ƒé…ç½®æ–‡ä»¶
cp .env.example .env

# ç”Ÿæˆåº”ç”¨å¯†é’¥
php artisan key:generate

# ç¼–è¾‘ç¯å¢ƒé…ç½®
nano .env
```

### 4. é…ç½®.envæ–‡ä»¶

```env
# åº”ç”¨åŸºç¡€é…ç½®
APP_NAME="MES Backend"
APP_ENV=local
APP_KEY=base64:your_app_key_here
APP_DEBUG=true
APP_TIMEZONE=Asia/Shanghai
APP_URL=http://mes-backend.local

# æ•°æ®åº“é…ç½®
DB_CONNECTION=pgsql
DB_HOST=localhost
DB_PORT=5432
DB_DATABASE=mes_development
DB_USERNAME=mes_dev
DB_PASSWORD=mes_dev_password

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PASSWORD=mes_redis_password
REDIS_PORT=6379
REDIS_DB=0

# ç¼“å­˜é…ç½®
CACHE_DRIVER=redis
SESSION_DRIVER=redis
QUEUE_CONNECTION=redis

# é‚®ä»¶é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
MAIL_MAILER=log
MAIL_HOST=localhost
MAIL_PORT=2525
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ENCRYPTION=null
MAIL_FROM_ADDRESS="noreply@mes-backend.local"
MAIL_FROM_NAME="${APP_NAME}"

# æ—¥å¿—é…ç½®
LOG_CHANNEL=stack
LOG_DEPRECATIONS_CHANNEL=null
LOG_LEVEL=debug

# æ–‡ä»¶ç³»ç»Ÿé…ç½®
FILESYSTEM_DISK=local

# é˜Ÿåˆ—é…ç½®
QUEUE_CONNECTION=redis

# Telescopeé…ç½®ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
TELESCOPE_ENABLED=true

# è°ƒè¯•å·¥å…·é…ç½®
DEBUGBAR_ENABLED=true
```

### 5. æ•°æ®åº“è¿ç§»å’Œå¡«å……

```bash
# è¿è¡Œæ•°æ®åº“è¿ç§»
php artisan migrate

# è¿è¡Œæ•°æ®å¡«å……ï¼ˆå¦‚æœæœ‰ï¼‰
php artisan db:seed

# åˆ›å»ºå­˜å‚¨é“¾æ¥
php artisan storage:link

# æ¸…é™¤é…ç½®ç¼“å­˜
php artisan config:clear
php artisan cache:clear
php artisan view:clear
php artisan route:clear
```

## ğŸ”§ å¼€å‘å·¥å…·é…ç½®

### 1. æ·»åŠ hostsæ–‡ä»¶è®°å½•

```bash
# Linux/macOS
echo "127.0.0.1 mes-backend.local" | sudo tee -a /etc/hosts

# Windowsï¼ˆåœ¨ç®¡ç†å‘˜æƒé™ä¸‹ï¼‰
echo "127.0.0.1 mes-backend.local" >> C:\Windows\System32\drivers\etc\hosts
```

### 2. IDEé…ç½®ï¼ˆæ¨èVS Codeï¼‰

```bash
# å®‰è£…PHPå¼€å‘æ‰©å±•åŒ…
code --install-extension bmewburn.vscode-intelephense-client
code --install-extension MehediDracula.php-namespace-resolver
code --install-extension ryannaddy.laravel-artisan
code --install-extension onecentlin.laravel-blade
code --install-extension codingyu.laravel-goto-view

# åˆ›å»ºVS Codeå·¥ä½œåŒºé…ç½®
mkdir -p .vscode
cat > .vscode/settings.json << 'EOF'
{
    "php.validate.executablePath": "/usr/bin/php",
    "php.suggest.basic": false,
    "intelephense.files.maxSize": 5000000,
    "blade.format.enable": true,
    "emmet.includeLanguages": {
        "blade": "html"
    }
}
EOF
```

### 3. Gité…ç½®

```bash
# é…ç½®Gitç”¨æˆ·ä¿¡æ¯
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"

# é…ç½®Gitç¼–è¾‘å™¨
git config --global core.editor "code --wait"

# é…ç½®Gitåˆ«å
git config --global alias.st status
git config --global alias.co checkout
git config --global alias.br branch
git config --global alias.cm commit
```

## âœ… ç¯å¢ƒéªŒè¯

### 1. æœåŠ¡çŠ¶æ€æ£€æŸ¥

```bash
# æ£€æŸ¥PHP-FPM
sudo systemctl status php8.1-fpm

# æ£€æŸ¥Nginx
sudo systemctl status nginx

# æ£€æŸ¥MySQL
sudo systemctl status mysql

# æ£€æŸ¥Redis
sudo systemctl status redis-server

# æ£€æŸ¥PostgreSQL
sudo systemctl status postgresql
```

### 2. é¡¹ç›®åŠŸèƒ½æµ‹è¯•

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆå¯é€‰ï¼Œä»…æµ‹è¯•ç”¨ï¼‰
php artisan serve --host=0.0.0.0 --port=8000

# è¿è¡Œæµ‹è¯•å¥—ä»¶
php artisan test

# æ£€æŸ¥è·¯ç”±åˆ—è¡¨
php artisan route:list

# æ£€æŸ¥é˜Ÿåˆ—å·¥ä½œå™¨
php artisan queue:work --once

# æ£€æŸ¥å®šæ—¶ä»»åŠ¡
php artisan schedule:run
```

### 3. è®¿é—®æµ‹è¯•

```bash
# æµè§ˆå™¨è®¿é—®æµ‹è¯•
curl -I http://mes-backend.local
# æˆ–
curl -I http://localhost:8000

# APIæ¥å£æµ‹è¯•
curl -X GET http://mes-backend.local/api/health
```

## ğŸ› ï¸ å¼€å‘å·¥å…·æ¨è

### å¿…å¤‡å·¥å…·

| å·¥å…· | ç”¨é€” | å®‰è£…å‘½ä»¤ |
|------|------|----------|
| **Laravel Debugbar** | è°ƒè¯•å·¥å…·æ  | `composer require barryvdh/laravel-debugbar --dev` |
| **Laravel Telescope** | åº”ç”¨ç›‘æ§ | `composer require laravel/telescope --dev` |
| **PHPUnit** | å•å…ƒæµ‹è¯• | Laravelå†…ç½® |
| **Pest** | ç°ä»£æµ‹è¯•æ¡†æ¶ | `composer require pestphp/pest --dev` |

### å¯é€‰å·¥å…·

| å·¥å…· | ç”¨é€” | å®‰è£…å‘½ä»¤ |
|------|------|----------|
| **Laravel Sail** | Dockerå¼€å‘ç¯å¢ƒ | `composer require laravel/sail --dev` |
| **Laravel Pint** | ä»£ç æ ¼å¼åŒ– | `composer require laravel/pint --dev` |
| **Larastan** | é™æ€åˆ†æ | `composer require nunomaduro/larastan --dev` |
| **Laravel IDE Helper** | IDEæç¤ºå¢å¼º | `composer require barryvdh/laravel-ide-helper --dev` |

### å®‰è£…æ¨èå¼€å‘å·¥å…·

```bash
# å®‰è£…å¼€å‘å·¥å…·åŒ…
composer require --dev barryvdh/laravel-debugbar
composer require --dev laravel/telescope
composer require --dev pestphp/pest
composer require --dev laravel/pint
composer require --dev barryvdh/laravel-ide-helper

# å‘å¸ƒTelescopeèµ„æº
php artisan telescope:install

# ç”ŸæˆIDEè¾…åŠ©æ–‡ä»¶
php artisan ide-helper:generate
php artisan ide-helper:models
php artisan ide-helper:meta
```

## ğŸš¨ å¸¸è§é—®é¢˜è§£å†³

### 1. æƒé™é—®é¢˜

```bash
# ä¿®å¤å­˜å‚¨ç›®å½•æƒé™
sudo chown -R www-data:www-data storage bootstrap/cache
sudo chmod -R 775 storage bootstrap/cache

# å¦‚æœæ˜¯å¼€å‘ç¯å¢ƒï¼Œå¯ä»¥ä½¿ç”¨ç”¨æˆ·æƒé™
sudo chown -R $USER:$USER storage bootstrap/cache
chmod -R 775 storage bootstrap/cache
```

### 2. PHPæ‰©å±•ç¼ºå¤±

```bash
# æ£€æŸ¥ç¼ºå¤±çš„æ‰©å±•
php -m | grep -E "(openssl|pdo|mbstring|tokenizer|xml|ctype|json|bcmath|pgsql|redis)"

# å®‰è£…ç¼ºå¤±çš„æ‰©å±•
sudo apt install php8.1-[extension-name]
sudo systemctl restart php8.1-fpm
```

### 3. æ•°æ®åº“è¿æ¥é—®é¢˜

```bash
# æ£€æŸ¥PostgreSQLæœåŠ¡
sudo systemctl status postgresql

# æ£€æŸ¥è¿æ¥
psql -U mes_dev -d mes_development -h localhost -c "SELECT 1;"

# é‡ç½®ç”¨æˆ·å¯†ç 
sudo -u postgres psql -c "ALTER USER mes_dev WITH PASSWORD 'new_password';"
```

### 4. Redisè¿æ¥é—®é¢˜

```bash
# æ£€æŸ¥RedisæœåŠ¡
sudo systemctl status redis-server

# æµ‹è¯•è¿æ¥
redis-cli ping

# æ£€æŸ¥é…ç½®
redis-cli config get requirepass
```

### 5. Nginxé…ç½®é—®é¢˜

```bash
# æ£€æŸ¥é…ç½®è¯­æ³•
sudo nginx -t

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log

# é‡æ–°åŠ è½½é…ç½®
sudo systemctl reload nginx
```

## ğŸ“ å¼€å‘ç¯å¢ƒç»´æŠ¤

### å®šæœŸç»´æŠ¤ä»»åŠ¡

```bash
# æ¸…ç†Laravelç¼“å­˜
php artisan config:clear
php artisan cache:clear
php artisan view:clear
php artisan route:clear

# æ›´æ–°Composerä¾èµ–
composer update

# æ›´æ–°Node.jsä¾èµ–
npm update

# é‡æ–°ç”ŸæˆIDEè¾…åŠ©æ–‡ä»¶
php artisan ide-helper:generate
```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

```bash
# å¼€å¯PHP OPcacheï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
sudo nano /etc/php/8.1/fpm/php.ini
# è®¾ç½® opcache.enable=1

# é…ç½®PHP-FPMè¿›ç¨‹æ± 
sudo nano /etc/php/8.1/fpm/pool.d/www.conf
# è°ƒæ•´ pm.max_children, pm.start_servers ç­‰å‚æ•°
```

---

**ğŸ‰ æ­å–œï¼** æ‚¨çš„MESåç«¯å¼€å‘ç¯å¢ƒå·²ç»æ­å»ºå®Œæˆã€‚ç°åœ¨å¯ä»¥è®¿é—® `http://mes-backend.local` å¼€å§‹å¼€å‘å·¥ä½œï¼

**ğŸ“‹ ä¸‹ä¸€æ­¥**ï¼šå‚è€ƒ [4. ç¯å¢ƒå˜é‡é…ç½®.md](./4.%20ç¯å¢ƒå˜é‡é…ç½®.md) äº†è§£è¯¦ç»†çš„ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜ã€‚